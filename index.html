<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Application</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: Arial, sans-serif;
            margin: 0;
            height: 100vh;
            background-color: #f5f5f5;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        #question {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 20px;
        }

        #answer-container {
            text-align: center;
        }

        #answer-input {
            width: 300px;
            height: 50px;
            font-size: 1.2rem;
            padding: 5px;
            margin-bottom: 10px;
        }

        button {
            font-size: 1.2rem;
            padding: 10px 20px;
            margin: 5px;
        }

        #results {
            margin-top: 20px;
        }

        .waiting-message {
            font-size: 1.5rem;
            color: #555;
            text-align: center;
            margin-top: 20px;
        }
    </style>
    <script>
        const hostMode = window.location.search.includes('host=true');
        let currentQuestionIndex = 0;
        let questions = [
            { question: "What is the capital of France?\nProvide the full name.", id: 1 },
            { question: "What is 2 + 2?\n(Hint: It is an even number)", id: 2 },
        ];
        let answers = {};

        function promptForUserId() {
            let userId = sessionStorage.getItem("userId");
            if (!userId) {
                userId = prompt("Please enter your participant number:");
                if (userId) {
                    sessionStorage.setItem("userId", userId);
                } else {
                    alert("Participant number is required to proceed.");
                    promptForUserId();
                }
            }
        }

        function loadQuestion() {
            const questionContainer = document.getElementById("question");
            const answerContainer = document.getElementById("answer-container");
            const waitingMessage = document.getElementById("waiting-message");

            if (currentQuestionIndex < questions.length) {
                questionContainer.innerHTML = questions[currentQuestionIndex].question.replace(/\n/g, '<br>');
                answerContainer.style.display = 'block';
                waitingMessage.style.display = 'none';
            } else {
                questionContainer.textContent = "Quiz completed!";
                answerContainer.style.display = 'none';
                waitingMessage.style.display = 'none';
                if (hostMode) {
                    displayResults();
                }
            }
        }

        function submitAnswer() {
            const answer = document.getElementById("answer-input").value;
            const userId = sessionStorage.getItem("userId");

            if (!userId) {
                alert("Participant number is missing. Please refresh and enter your participant number.");
                return;
            }

            answers[userId] = answers[userId] || [];
            answers[userId].push({
                questionId: questions[currentQuestionIndex].id,
                answer: answer
            });

            syncAnswers();

            document.getElementById("answer-input").value = "";

            document.getElementById("answer-container").style.display = 'none';
            document.getElementById("waiting-message").style.display = 'block';
        }

        function allowNextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        function displayResults() {
            const resultsContainer = document.getElementById("results");
            resultsContainer.innerHTML = "<h2>Results</h2>";
            for (const [userId, userAnswers] of Object.entries(answers)) {
                resultsContainer.innerHTML += `<p>User ${userId}:<br>${userAnswers.map(a => `Q${a.questionId}: ${a.answer}`).join('<br>')}</p>`;
            }
        }

        function syncAnswers() {
            if (hostMode) {
                localStorage.setItem("quizAnswers", JSON.stringify(answers));
            } else {
                const storedAnswers = localStorage.getItem("quizAnswers");
                if (storedAnswers) {
                    answers = JSON.parse(storedAnswers);
                }
            }
        }

        function pollForUpdates() {
            setInterval(() => {
                if (hostMode) {
                    const storedAnswers = localStorage.getItem("quizAnswers");
                    if (storedAnswers) {
                        answers = JSON.parse(storedAnswers);
                        displayResults();
                    }
                }
            }, 1000);
        }

        window.onload = () => {
            if (!hostMode) {
                promptForUserId();
            }
            syncAnswers();
            pollForUpdates();
            document.getElementById("host-controls").style.display = hostMode ? 'block' : 'none';
            loadQuestion();
        };
    </script>
</head>
<body>
    <h1>Quiz Application</h1>

    <div id="question"></div>

    <div id="answer-container">
        <input type="text" id="answer-input" placeholder="Enter your answer">
        <button onclick="submitAnswer()">Submit Answer</button>
    </div>

    <div id="waiting-message" class="waiting-message" style="display: none;">
        Answer received! Please wait for the next question.
    </div>

    <div id="host-controls" style="display: none;">
        <button onclick="allowNextQuestion()">Next Question</button>
        <button onclick="displayResults()">Show Results</button>
    </div>

    <div id="results"></div>
</body>
</html>
